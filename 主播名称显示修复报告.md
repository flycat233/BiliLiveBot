# ğŸ”§ ä¸»æ’­åç§°æ˜¾ç¤ºä¿®å¤æŠ¥å‘Š

## ğŸ› é—®é¢˜æè¿°

**é—®é¢˜**: ä¸»æ’­å¡ç‰‡æ˜¾ç¤º"ä¸»æ’­3632305167927467"è€Œä¸æ˜¯"é›ªç»’æ‘‡"

**UID**: 3632305167927467  
**æœŸæœ›æ˜¾ç¤º**: é›ªç»’æ‘‡  
**å®é™…æ˜¾ç¤º**: ä¸»æ’­3632305167927467

## ğŸ” é—®é¢˜åˆ†æ

### æ•°æ®æµç¨‹

```
1. å‰ç«¯è¯·æ±‚ â†’ /api/room/info/1837226318
2. åç«¯è°ƒç”¨ â†’ get_anchor_info()
3. å°è¯•ä¸»æ’­API â†’ /live_user/v1/Master/get_anchor_info
4. å¦‚æœå¤±è´¥ â†’ ç”¨æˆ·API /x/space/acc/info?mid=xxx
5. è¿”å›æ•°æ® â†’ { anchor: { uname: "é›ªç»’æ‘‡" } }
6. å‰ç«¯æ˜¾ç¤º â†’ anchorName.textContent
```

### å¯èƒ½çš„åŸå› 

1. **ä¸»æ’­ä¿¡æ¯APIå¤±è´¥** - ç¬¬ä¸€ä¸ªAPIæ²¡æœ‰è¿”å›ä¸»æ’­å
2. **å¤‡ç”¨æ–¹æ¡ˆå¤±è´¥** - ç”¨æˆ·ä¿¡æ¯APIä¹Ÿæ²¡æœ‰æˆåŠŸè·å–
3. **æ•°æ®ç»“æ„é”™è¯¯** - APIè¿”å›çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆé¢„æœŸ
4. **å‰ç«¯CORSé—®é¢˜** - å‰ç«¯å¼‚æ­¥è·å–è¢«æµè§ˆå™¨é˜»æ­¢

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. åç«¯APIå¢å¼º

**æ–‡ä»¶**: `server.py`

**ä¿®æ”¹**: åœ¨APIå±‚æ·»åŠ é¢å¤–çš„ä¸»æ’­åè·å–é€»è¾‘

```python
@app.get("/api/room/info/{room_id}")
async def get_room_info_api(room_id: int):
    # ... è·å–æˆ¿é—´å’Œä¸»æ’­ä¿¡æ¯
    
    # å¦‚æœä¸»æ’­åä¸ºç©ºï¼Œé¢å¤–å°è¯•è·å–
    if not anchor_data.get("uname") and room_data.get("uid"):
        try:
            async with httpx.AsyncClient(timeout=5.0) as client:
                user_url = f"https://api.bilibili.com/x/space/acc/info?mid={room_data['uid']}"
                resp = await client.get(user_url, headers=headers)
                if resp.status_code == 200:
                    user_data = resp.json()
                    if user_data.get("code") == 0:
                        anchor_data["uname"] = user_data["data"].get("name", "")
                        print(f"[API] é€šè¿‡ç”¨æˆ·APIè·å–ä¸»æ’­å: {anchor_data['uname']}")
        except Exception as e:
            print(f"[API] é¢å¤–è·å–ä¸»æ’­åå¤±è´¥: {e}")
```

**ä¼˜ç‚¹**:
- åœ¨åç«¯ç»Ÿä¸€å¤„ç†ï¼Œé¿å…CORSé—®é¢˜
- æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- ç¡®ä¿è¿”å›çš„æ•°æ®ä¸€å®šæœ‰ä¸»æ’­å

### 2. å‰ç«¯é€»è¾‘ç®€åŒ–

**æ–‡ä»¶**: `templates/index.html`

**ä¿®æ”¹**: ç§»é™¤å‰ç«¯å¼‚æ­¥è·å–ï¼Œå®Œå…¨ä¾èµ–åç«¯æ•°æ®

```javascript
// ä¸»æ’­åç§°ï¼šç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„æ•°æ®
let displayName = 'æœªçŸ¥ä¸»æ’­';
if (roomData.anchor && roomData.anchor.uname) {
    displayName = roomData.anchor.uname;
    console.log('[ç›´æ’­é—´ä¿¡æ¯] ä¸»æ’­å:', displayName);
} else {
    console.warn('[ç›´æ’­é—´ä¿¡æ¯] åç«¯æœªè¿”å›ä¸»æ’­åï¼ŒUID:', uid);
    displayName = uid ? `ä¸»æ’­${uid}` : 'æœªçŸ¥ä¸»æ’­';
}
```

**ä¼˜ç‚¹**:
- é€»è¾‘ç®€å•æ¸…æ™°
- é¿å…CORSé—®é¢˜
- å‡å°‘å‰ç«¯è¯·æ±‚

### 3. æ·»åŠ è¯¦ç»†æ—¥å¿—

**åç«¯æ—¥å¿—**:
```python
print(f"[API] è¿”å›æ•°æ® - ä¸»æ’­å: {anchor_data.get('uname', 'æ— ')}, UID: {room_data.get('uid', 'æ— ')}")
```

**å‰ç«¯æ—¥å¿—**:
```javascript
console.log('[ç›´æ’­é—´ä¿¡æ¯] ä¸»æ’­å:', displayName);
console.warn('[ç›´æ’­é—´ä¿¡æ¯] åç«¯æœªè¿”å›ä¸»æ’­åï¼ŒUID:', uid);
```

## ğŸ”§ è°ƒè¯•æ–¹æ³•

### 1. æŸ¥çœ‹åç«¯æ—¥å¿—

é‡å¯æœåŠ¡å™¨åï¼Œè¿æ¥ç›´æ’­é—´ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```
[è°ƒè¯•] ä¸»æ’­ä¿¡æ¯APIå“åº”: 200
[è°ƒè¯•] ä¸»æ’­ä¿¡æ¯æ•°æ®: {...}
[è°ƒè¯•] ä»ç”¨æˆ·ä¿¡æ¯APIè·å–ä¸»æ’­æ•°æ®æˆåŠŸ: {'uname': 'é›ªç»’æ‘‡', ...}
[API] è¿”å›æ•°æ® - ä¸»æ’­å: é›ªç»’æ‘‡, UID: 3632305167927467
```

**å¦‚æœçœ‹åˆ°**:
- âœ… `ä¸»æ’­å: é›ªç»’æ‘‡` - æˆåŠŸ
- âŒ `ä¸»æ’­å: æ— ` - å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

### 2. æŸ¥çœ‹å‰ç«¯Console

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼ŒæŸ¥çœ‹Consoleï¼š

```javascript
[ç›´æ’­é—´ä¿¡æ¯] APIå“åº”: {success: true, data: {...}}
[ç›´æ’­é—´ä¿¡æ¯] ä¸»æ’­å: é›ªç»’æ‘‡
[ç›´æ’­é—´ä¿¡æ¯] å·²æ›´æ–°ä¸»æ’­åç§°æ˜¾ç¤º: é›ªç»’æ‘‡
```

**å¦‚æœçœ‹åˆ°**:
- âœ… `ä¸»æ’­å: é›ªç»’æ‘‡` - åç«¯è¿”å›æ­£ç¡®
- âŒ `åç«¯æœªè¿”å›ä¸»æ’­å` - åç«¯APIæœ‰é—®é¢˜

### 3. æ£€æŸ¥APIå“åº”

åœ¨Networkæ ‡ç­¾ä¸­æŸ¥çœ‹APIè¯·æ±‚ï¼š

```
GET /api/room/info/1837226318
Status: 200 OK

Response:
{
  "success": true,
  "data": {
    "room_id": 1837226318,
    "uid": 3632305167927467,
    "anchor": {
      "uid": 3632305167927467,
      "uname": "é›ªç»’æ‘‡",  â† åº”è¯¥æœ‰è¿™ä¸ªå­—æ®µ
      "level": 20,
      ...
    }
  }
}
```

## ğŸ“Š Bç«™APIè¯´æ˜

### 1. ä¸»æ’­ä¿¡æ¯API

**URL**: `https://api.live.bilibili.com/live_user/v1/Master/get_anchor_info`

**å‚æ•°**: `roomid=1837226318`

**è¿”å›ç»“æ„**:
```json
{
  "code": 0,
  "data": {
    "info": {
      "uid": 3632305167927467,
      "uname": "é›ªç»’æ‘‡",
      "platform_user_level": 20,
      ...
    }
  }
}
```

### 2. ç”¨æˆ·ä¿¡æ¯APIï¼ˆå¤‡ç”¨ï¼‰

**URL**: `https://api.bilibili.com/x/space/acc/info`

**å‚æ•°**: `mid=3632305167927467`

**è¿”å›ç»“æ„**:
```json
{
  "code": 0,
  "data": {
    "mid": 3632305167927467,
    "name": "é›ªç»’æ‘‡",
    "level": 5,
    ...
  }
}
```

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰
```
ğŸ‘¤ ä¸»æ’­
ä¸»æ’­3632305167927467  â† é”™è¯¯
Lv20 â€¢ UID: 3632305167927467
```

### ä¿®å¤å
```
ğŸ‘¤ ä¸»æ’­
é›ªç»’æ‘‡  â† æ­£ç¡®
Lv20 â€¢ UID: 3632305167927467
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

```
backend/
â”œâ”€â”€ server.py
â”‚   âœ… APIå±‚æ·»åŠ é¢å¤–ä¸»æ’­åè·å–
â”‚   âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—
â”‚   âœ… æ·»åŠ å¼‚å¸¸å¤„ç†
â””â”€â”€ templates/
    â””â”€â”€ index.html
        âœ… ç®€åŒ–å‰ç«¯é€»è¾‘
        âœ… ç§»é™¤å¼‚æ­¥è·å–
        âœ… å®Œå…¨ä¾èµ–åç«¯æ•°æ®
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. é‡å¯æœåŠ¡å™¨
```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
python server.py
```

### 2. æ¸…é™¤ç¼“å­˜
```
Ctrl + F5 å¼ºåˆ¶åˆ·æ–°
```

### 3. è¿æ¥ç›´æ’­é—´
1. è¾“å…¥æˆ¿é—´å·: 1837226318
2. ç‚¹å‡»"è¿æ¥ç›´æ’­é—´"
3. æŸ¥çœ‹ä¸»æ’­åæ˜¯å¦æ˜¾ç¤º"é›ªç»’æ‘‡"

### 4. éªŒè¯ç»“æœ

**æˆåŠŸæ ‡å¿—**:
- âœ… ä¸»æ’­å¡ç‰‡æ˜¾ç¤º"é›ªç»’æ‘‡"
- âœ… UIDæ˜¾ç¤º"3632305167927467"
- âœ… Consoleæ— é”™è¯¯æˆ–è­¦å‘Š

**å¤±è´¥æ ‡å¿—**:
- âŒ æ˜¾ç¤º"ä¸»æ’­3632305167927467"
- âŒ æ˜¾ç¤º"æœªçŸ¥ä¸»æ’­"
- âŒ Consoleæœ‰è­¦å‘Š"åç«¯æœªè¿”å›ä¸»æ’­å"

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: ä»ç„¶æ˜¾ç¤º"ä¸»æ’­3632305167927467"

**æ£€æŸ¥**:
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æˆåŠŸè·å–ä¸»æ’­å
2. æŸ¥çœ‹Networkï¼Œç¡®è®¤APIè¿”å›çš„æ•°æ®ä¸­æœ‰`anchor.uname`
3. æŸ¥çœ‹Consoleï¼Œç¡®è®¤å‰ç«¯æ˜¯å¦æ­£ç¡®è¯»å–

**è§£å†³**:
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
python server.py
# åº”è¯¥çœ‹åˆ°: [API] è¿”å›æ•°æ® - ä¸»æ’­å: é›ªç»’æ‘‡
```

### é—®é¢˜2: æ˜¾ç¤º"æœªçŸ¥ä¸»æ’­"

**åŸå› **: åç«¯APIå®Œå…¨å¤±è´¥

**æ£€æŸ¥**:
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. Bç«™APIæ˜¯å¦å¯è®¿é—®
3. æ˜¯å¦æœ‰é˜²ç«å¢™é˜»æ­¢

**è§£å†³**:
```python
# æ‰‹åŠ¨æµ‹è¯•API
import httpx
import asyncio

async def test():
    async with httpx.AsyncClient() as client:
        resp = await client.get('https://api.bilibili.com/x/space/acc/info?mid=3632305167927467')
        print(resp.json())

asyncio.run(test())
```

### é—®é¢˜3: ä¸åŒç›´æ’­é—´æœ‰çš„æ˜¾ç¤ºæœ‰çš„ä¸æ˜¾ç¤º

**åŸå› **: ä¸åŒä¸»æ’­çš„APIæ•°æ®ç»“æ„å¯èƒ½ä¸åŒ

**è§£å†³**: 
- æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤å“ªä¸ªAPIæˆåŠŸ
- æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ä»£ç 

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ ç¼“å­˜
```python
# ç¼“å­˜ä¸»æ’­åï¼Œé¿å…é‡å¤è¯·æ±‚
anchor_name_cache = {}
```

### 2. æ·»åŠ é‡è¯•æœºåˆ¶
```python
# å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
for i in range(3):
    try:
        # è·å–ä¸»æ’­å
        break
    except:
        if i < 2:
            await asyncio.sleep(1)
```

### 3. æ·»åŠ é™çº§æ–¹æ¡ˆ
```python
# å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥ï¼Œä½¿ç”¨æˆ¿é—´æ ‡é¢˜æ¨æµ‹
if not uname:
    uname = room_data.get("title", "").split("çš„")[0]
```

## ğŸ‰ æ€»ç»“

ä¿®å¤å†…å®¹ï¼š
- âœ… åç«¯APIå±‚æ·»åŠ é¢å¤–ä¸»æ’­åè·å–
- âœ… å‰ç«¯é€»è¾‘ç®€åŒ–ï¼Œç§»é™¤å¼‚æ­¥è·å–
- âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—ä¾¿äºè°ƒè¯•
- âœ… å®Œå–„å¼‚å¸¸å¤„ç†

ç°åœ¨ä¸»æ’­ååº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤ºä¸º"é›ªç»’æ‘‡"äº†ï¼ğŸŠ

---

**æµ‹è¯•ç”¨ä¾‹**:
- æˆ¿é—´å·: 1837226318
- UID: 3632305167927467
- æœŸæœ›ä¸»æ’­å: é›ªç»’æ‘‡
